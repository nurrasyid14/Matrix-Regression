<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RegressorMatrice — Dashboard</title>

  <!-- Tailwind for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 18px rgba(16,24,40,0.06); padding: 1.25rem; }
    .metric { min-width: 120px; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 p-6">

  <div class="max-w-7xl mx-auto grid gap-6">
    <header class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold">RegressorMatrice</h1>
        <p class="text-sm text-gray-600">Matrix-based Regression Dashboard</p>
      </div>
      <div class="text-sm text-gray-500">Local dev</div>
    </header>

    <!-- Upload & Controls -->
    <section class="card">
      <div class="grid md:grid-cols-3 gap-6">
        <div>
          <label class="block text-sm font-medium mb-2">Upload dataset (.csv, .xlsx, .json)</label>
          <div class="flex items-center gap-3">
            <input id="file-upload" type="file" accept=".csv,.xlsx,.xls,.json" class="hidden">
            <label for="file-upload" id="btn-choose" class="bg-indigo-600 text-white px-4 py-2 rounded cursor-pointer">Choose file</label>
            <div id="file-name" class="text-sm text-gray-600">No file chosen</div>
          </div>
          <p id="upload-hint" class="text-xs text-gray-500 mt-2">Only numeric columns will be used.</p>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Regression Type</label>
          <select id="regression-type" class="w-full border rounded px-3 py-2">
            <option value="linear">Linear Regression</option>
            <option value="ridge">Ridge Regression</option>
            <option value="polynomial">Polynomial Regression</option>
          </select>

          <div id="polynomial-options" class="mt-3 hidden">
            <label class="block text-sm font-medium mb-1">Polynomial Degree</label>
            <input id="poly-degree" type="number" min="2" max="6" value="2" class="w-28 border rounded px-2 py-1">
          </div>

          <div id="ridge-options" class="mt-3 hidden">
            <label class="block text-sm font-medium mb-1">Ridge α</label>
            <input id="ridge-alpha" type="number" step="0.1" min="0" value="1.0" class="w-28 border rounded px-2 py-1">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Actions</label>
          <div class="flex gap-3">
            <button id="btn-run" class="bg-green-600 text-white px-4 py-2 rounded font-semibold">Run Analysis</button>
            <button id="btn-reset" class="bg-gray-200 px-4 py-2 rounded">Reset</button>
          </div>

          <div id="status" class="mt-3 text-sm text-gray-600"></div>
        </div>
      </div>
    </section>

    <!-- Feature / Target selectors -->
    <section class="card">
      <h2 class="font-semibold mb-3">Select Features & Target</h2>

      <div class="grid md:grid-cols-3 gap-6">
        <div>
          <h3 class="text-sm font-medium mb-2">Features (X)</h3>
          <div id="feature-selector" class="h-44 overflow-y-auto border rounded p-3 bg-gray-50"></div>
          <div class="mt-2 flex gap-2">
            <button id="select-all-features" class="text-xs bg-gray-200 px-2 py-1 rounded">Select All</button>
            <button id="deselect-all-features" class="text-xs bg-gray-200 px-2 py-1 rounded">Deselect All</button>
          </div>
        </div>

        <div>
          <h3 class="text-sm font-medium mb-2">Target (Y)</h3>
          <div id="target-selector" class="h-44 overflow-y-auto border rounded p-3 bg-gray-50"></div>
        </div>

        <div>
          <h3 class="text-sm font-medium mb-2">Preview (first 5 rows)</h3>
          <div id="preview" class="h-44 overflow-y-auto border rounded p-3 bg-gray-50 text-xs"></div>
        </div>
      </div>
    </section>

    <!-- Results Dashboard -->
    <section class="grid md:grid-cols-3 gap-6">
      <div class="card md:col-span-1">
        <h3 class="font-semibold mb-3">Summary</h3>
        <div id="equation" class="text-sm font-mono text-gray-700 mb-4">—</div>

        <h4 class="text-sm font-semibold mb-2">Model Metrics</h4>
        <div id="metrics" class="grid grid-cols-2 gap-3">
          <div class="metric p-3 bg-gray-50 rounded">
            <div class="text-xs text-gray-500">R²</div>
            <div id="metric-r2" class="text-lg font-bold">—</div>
          </div>
          <div class="metric p-3 bg-gray-50 rounded">
            <div class="text-xs text-gray-500">MSE</div>
            <div id="metric-mse" class="text-lg font-bold">—</div>
          </div>
          <div class="metric p-3 bg-gray-50 rounded">
            <div class="text-xs text-gray-500">RMSE</div>
            <div id="metric-rmse" class="text-lg font-bold">—</div>
          </div>
          <div class="metric p-3 bg-gray-50 rounded">
            <div class="text-xs text-gray-500">MAE</div>
            <div id="metric-mae" class="text-lg font-bold">—</div>
          </div>
          <div class="metric p-3 bg-gray-50 rounded col-span-2">
            <div class="text-xs text-gray-500">Explained Variance</div>
            <div id="metric-ev" class="text-lg font-bold">—</div>
          </div>
        </div>
      </div>

      <div class="card md:col-span-2">
        <h3 class="font-semibold mb-3">Feature Coefficients</h3>
        <canvas id="coef-chart" height="120"></canvas>

        <hr class="my-4">

        <h3 class="font-semibold mb-3">Actual vs Predicted</h3>
        <canvas id="accuracy-chart" height="180"></canvas>
      </div>
    </section>

    <footer class="text-xs text-gray-400 text-center mt-6">
      RegressorMatrice — matrix-driven regression
    </footer>
  </div>

  <!-- ✅ JavaScript loading order matters! -->
  <!-- API.js defines the API object first -->
  <script src="{{ url_for('static', filename='js/api.js') }}"></script>

  <!-- UI.js defines UI helper functions next -->
  <script src="{{ url_for('static', filename='js/ui.js') }}"></script>

  <!-- Main.js runs last, after API and UI are ready -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
